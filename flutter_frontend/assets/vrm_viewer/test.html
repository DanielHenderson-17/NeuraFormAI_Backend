<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>VRM Test</title>
    <style>
      body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #222;
        color: white;
        font-family: Arial, sans-serif;
      }
      #status {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 100;
        background: rgba(0,0,0,0.8);
        padding: 10px;
        border-radius: 5px;
      }
      canvas {
        display: block;
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        z-index: 1 !important;
        border: 5px solid lime !important;
      }
    </style>
  </head>
  <body>
    <div id="status">Loading...</div>
    <script src="./bundle.js"></script>
    <script>
      try {
        document.getElementById('status').innerHTML = 'Bundle loaded, checking Three.js...';
        
        // Test WebGL support first
        const webglTestCanvas = document.createElement('canvas');
        const gl = webglTestCanvas.getContext('webgl') || webglTestCanvas.getContext('experimental-webgl');
        if (gl) {
          document.getElementById('status').innerHTML += '<br>‚úÖ WebGL context available';
          document.getElementById('status').innerHTML += '<br>üîß WebGL vendor: ' + gl.getParameter(gl.VENDOR);
          document.getElementById('status').innerHTML += '<br>üîß WebGL renderer: ' + gl.getParameter(gl.RENDERER);
        } else {
          document.getElementById('status').innerHTML += '<br>‚ùå WebGL context NOT available';
        }
        
        if (typeof Scene !== 'undefined') {
          document.getElementById('status').innerHTML += '<br>‚úÖ Scene class available';
        } else {
          document.getElementById('status').innerHTML += '<br>‚ùå Scene class not found';
        }
        
        if (typeof WebGLRenderer !== 'undefined') {
          document.getElementById('status').innerHTML += '<br>‚úÖ WebGLRenderer available';
        } else {
          document.getElementById('status').innerHTML += '<br>‚ùå WebGLRenderer not found';
        }
        
        if (typeof BoxGeometry !== 'undefined') {
          document.getElementById('status').innerHTML += '<br>‚úÖ BoxGeometry available';
        } else {
          document.getElementById('status').innerHTML += '<br>‚ùå BoxGeometry not found';
        }
        
        // Try to create a simple scene
        const scene = new Scene();
        const camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        // Try WebGL first, fall back to Canvas if needed
        let renderer;
        try {
          renderer = new WebGLRenderer({ antialias: true });
          document.getElementById('status').innerHTML += '<br>‚úÖ Using WebGLRenderer';
        } catch (e) {
          // If WebGL fails, we could try CanvasRenderer (though it's deprecated)
          document.getElementById('status').innerHTML += '<br>‚ùå WebGLRenderer failed: ' + e.message;
          renderer = new WebGLRenderer({ antialias: true, failIfMajorPerformanceCaveat: false });
        }
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x444444); // Changed back to darker gray to see contrast
        document.body.appendChild(renderer.domElement);
        
        // Log renderer info
        document.getElementById('status').innerHTML += '<br>üéÆ Renderer: ' + renderer.constructor.name;
        document.getElementById('status').innerHTML += '<br>üé® Canvas size: ' + renderer.domElement.width + 'x' + renderer.domElement.height;
        
        // FIRST: Test if canvas itself works with 2D context
        const testCanvas = document.createElement('canvas');
        testCanvas.width = 200;
        testCanvas.height = 200;
        testCanvas.style.position = 'absolute';
        testCanvas.style.top = '10px';
        testCanvas.style.right = '10px';
        testCanvas.style.border = '2px solid red';
        testCanvas.style.background = 'blue';
        document.body.appendChild(testCanvas);
        
        const ctx = testCanvas.getContext('2d');
        ctx.fillStyle = 'yellow';
        ctx.fillRect(50, 50, 100, 100);
        ctx.fillStyle = 'white';
        ctx.font = '16px Arial';
        ctx.fillText('2D Test', 60, 110);
        
        // Create a MASSIVE cube that fills the entire screen
        const geometry = new BoxGeometry(20, 20, 20); // Huge cube
        const material = new MeshBasicMaterial({ 
          color: 0xff0000, // Bright red
          wireframe: false, // Solid
          side: THREE.DoubleSide // Render both sides
        });
        const cube = new Mesh(geometry, material);
        cube.position.set(0, 0, 0);
        scene.add(cube);
        
        // Position camera INSIDE the cube so we see red everywhere
        camera.position.set(0, 0, 0); // Camera at origin, inside the cube
        camera.lookAt(1, 0, 0); // Look towards +X
        camera.updateProjectionMatrix();
        
        document.getElementById('status').innerHTML += '<br>‚úÖ Scene created successfully';
        document.getElementById('status').innerHTML += '<br>üìä Cube size: 2x2x2, Camera at (0,0,5)';
        document.getElementById('status').innerHTML += '<br>üîç Scene children: ' + scene.children.length;
        document.getElementById('status').innerHTML += '<br>üìê Camera FOV: ' + camera.fov + '¬∞';
        document.getElementById('status').innerHTML += '<br>üìè Camera aspect: ' + camera.aspect.toFixed(2);
        
        // Test direct canvas clearing to see if WebGL works at all
        const renderContext = renderer.getContext();
        if (renderContext) {
          document.getElementById('status').innerHTML += '<br>‚úÖ WebGL context obtained';
          
          // Try multiple different colors to see if ANY show up
          renderContext.clearColor(1.0, 0.0, 1.0, 1.0); // Bright magenta
          renderContext.clear(renderContext.COLOR_BUFFER_BIT);
          
          // Also try setting the canvas background directly
          renderer.domElement.style.backgroundColor = 'cyan';
          
          document.getElementById('status').innerHTML += '<br>üé® Manual clear applied (should be magenta)';
          document.getElementById('status').innerHTML += '<br>üé® Canvas background set to cyan';
        } else {
          document.getElementById('status').innerHTML += '<br>‚ùå No WebGL context from renderer';
        }
        
        // Try manual render before animation
        renderer.render(scene, camera);
        document.getElementById('status').innerHTML += '<br>üé¨ Manual render completed';
        
        // Animate
        let frameCount = 0;
        function animate() {
          requestAnimationFrame(animate);
          
          cube.rotation.x += 0.01;
          cube.rotation.y += 0.01;
          
          renderer.render(scene, camera);
          
          // Log first few frames for debugging
          if (frameCount < 2) {
            console.log('Frame', frameCount, 'rendered. Camera pos:', camera.position);
            frameCount++;
          }
          
          // Update status with frame info once
          if (frameCount === 1) {
            document.getElementById('status').innerHTML += '<br>üé¨ Animation loop active!';
          }
        }
        animate();
        
        document.getElementById('status').innerHTML += '<br>‚úÖ Animation started!';
        
      } catch (error) {
        document.getElementById('status').innerHTML += '<br>‚ùå Error: ' + error.message;
        console.error('Three.js test error:', error);
      }
    </script>
  </body>
</html>
